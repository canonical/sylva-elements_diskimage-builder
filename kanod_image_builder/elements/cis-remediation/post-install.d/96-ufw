#!/bin/bash

ufw allow in from 10.42.0.0/16 to any comment "allow internal k8s traffic (pods)"
ufw allow in from 10.43.0.0/16 to any comment "allow internal k8s traffic (services)"
ufw allow in proto tcp from any to any port 2379,2380,2381 comment "allow etcd"
ufw allow in proto tcp from any to any port 6443,9345,2399,2400 comment "rke2 server"
ufw allow in proto udp from any to any port 53 comment "allow DNS"
ufw allow in proto tcp from any to any port 179 comment "Calico BGP"
ufw allow in proto udp from any to any port 4789 comment "Calico VXLAN"
ufw allow in proto tcp from any to any port 5473 comment "Calico Typha"
ufw allow in proto tcp from any to any port 7946,7472 comment "metallb speaker"
ufw allow in proto udp from any to any port 7946 comment "metallb speaker udp"
ufw allow out proto tcp from any to any port 179 comment "Calico BGP"
ufw allow out proto udp from any to any port 4789 comment "Calico VXLAN"
ufw allow out proto tcp from any to any port 5473 comment "Calico Typha"
ufw allow out proto udp from any to any port 123 comment "allow NTP"
ufw allow out proto udp from any to any port 53 comment "allow DNS"
ufw allow out proto tcp from any to any port 6443 comment "allow kube-api out"
ufw allow out proto udp from any to any port 123 comment "allow NTP"
ufw allow out proto udp from any to any port 53  comment "allow DNS"
ufw allow out proto tcp from any to any port 3128,8080 comment "allow proxy"
ufw allow out from any to 10.42.0.0/16 comment "allow internal k8s traffic (pods)"
ufw allow out from any to 10.43.0.0/16 comment "allow internal k8s traffic (services)"
ufw allow out proto tcp from any to any port 2379,2380,2381 comment "allow etcd"
ufw allow out proto tcp from any to any port 6443,9345,2399,2400 comment "rke2 server"
ufw allow out proto tcp from any to any port 7946,7472 comment "metallb speaker"
ufw allow out proto udp from any to any port 7946 comment "metallb speaker udp"
